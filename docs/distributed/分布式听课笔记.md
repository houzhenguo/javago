
## 分布式
1. 分布式系统数据同步（replication 机制）

2. replication vs backup
 Keep a copy of same data on multiple machines that are connected via a network
 为什么？
 a. 高可用
 b. 扩展性 水平扩展，提高读的吞吐量
 c. 减少延迟 将数据放在 地理位置更靠近用户的位置 CDN

replication 带来的一些问题
数据一致性问题

Replication 是 业务的连续性和数据实时同步，实时复杂度要高一些 （预算够就用它）
Backup 关注 DR, Disaster Recovery 灾难恢复

先做replication 再考虑 partion
Replication VS Partioning
1. Partioning 读写吞吐量比较高。

3. high level
   replication models
   分布式系统怎么做 replication


## 数据同步
1. 主从复制 single leader 所有client 将请求发送到leader,参考 mysql
2. 主主复制 -> MultiLeader ，发送到其中一个leader， 然后由该leader负责同步，多机房部署
   每隔Data Center 有一个单主，两个DC之间互为主备
   为啥同一个机房不蚕蛹 Multi-Leader ?
   架构更加复杂
3. 无主模式

版本控制
定时同步，数据修复

Replication Method 目前是 针对 single Leader
1. 同步复制 所有follower
2. 异步复制 至少一个follower确认
3. 半同步 一主多从
异步复制，写入性能高， 可用性高，但是数据是弱一致的,用的最多。

1. 命令同步
2. 逻辑日志 ，比如 要更新哪些列 -> 可以做数据异构 -> 日志体积大，between （）就会产生几千行
3. WAL

数据延迟 lag

写一致性 当用户读取一样可能被修改的数据，可以从leader
若大多数数据都可能被修改，判断最近有没有被修改，判断读取哪个。
通过用户userID 路由到同一个 ，担心负载均衡，一致性hash

Muilte Leader 会有写冲突的问题。

基于 leader 的模式下，由 leader 对写操作进行排序，follower 严格按照与 leader 相同顺序来执行。而在leaderless模式下，多个节点如何定义事件先后顺序？如何判断两个操作是否同时发生？


每台机器的时间可能存在差异，消息的传递在不同的网络状况下有不同的延迟，因此在分布式系统中以物理时间或者消息接收的顺序来决定事件发生的顺序是不准确的。






